<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Circle Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1 {
            text-align: center;
        }
        input[type="text"] {
            width: 200px;
            padding: 5px;
            margin-right: 10px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .output {
            margin-top: 20px;
            font-size: 18px;
        }
        .checkbox-container {
            margin: 20px auto;
            max-width: 400px;
        }
        .checkbox-container label {
            display: block;
            margin: 10px 0;
        }
        .circle-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }
        .circle-name {
            padding: 10px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border-radius: 50%;
        }
        #toggleAllButton {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <!-- Canvas for drawing the circle diagram -->

<canvas id="circleCanvas" width="600" height="600" style="display: none;"></canvas>

<h1>Random Circle Generator</h1>

<!-- Checkbox for Output Style -->
<label>
    <input type="checkbox" id="outputStyle" checked> Output as Circle Diagram
</label>

<!-- Button to generate list -->
<button id="generateButton" disabled>Generate Circle</button>

<!-- Toggle Select/Unselect all -->
<button id="toggleAllButton">Unselect All</button>

<!-- Checkboxes for names -->
<div class="checkbox-container" id="checkboxContainer"></div>

<!-- Output Section -->
<div class="output" id="output"></div>

<!-- Input for adding new names -->
<input type="text" id="newName" placeholder="Add new name">
<button id="addNameButton">Add Name</button>

<script>
    // Predefined list of names
    const predefinedNames = [
        "Adam", "Akalya", "Andu", "Alvaro", "Anik", "Carlo", "Fabian", "Isadora", 
        "Jara", "Lars", "Luca", "Malin", "Mark", "Marko", "Matti", "Melisa", 
        "Nelio", "Nikitas", "Nils", "Nora", "Seth", "Sophie", "Vincent", "Zakaria"
    ];

    let selectAll = false;  // Track if all names are selected or unselected

    // Load names from cookie if available, otherwise use predefined names
    let names = getCookie("selectedNames") ? JSON.parse(getCookie("selectedNames")) : predefinedNames;

   // Function to display checkboxes for names
function displayCheckboxes(names) {
    const container = document.getElementById('checkboxContainer');
    container.innerHTML = ''; // Clear previous content

    names.forEach(name => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = name;
        checkbox.checked = true; // Default all names to be checked
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(name));
        container.appendChild(label);
    });

    document.getElementById('generateButton').disabled = false; // Enable the button
}


    // Display checkboxes on page load
    displayCheckboxes(names);

    // Add a new name to the list
    document.getElementById('addNameButton').addEventListener('click', function () {
        const newName = document.getElementById('newName').value.trim();
        if (newName) {
            names.push(newName);
            displayCheckboxes(names);
            document.getElementById('newName').value = ''; // Clear input field
        }
    });

    // Toggle Select/Unselect All button
    document.getElementById('toggleAllButton').addEventListener('click', function () {
        const checkboxes = document.querySelectorAll('#checkboxContainer input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            checkbox.checked = !selectAll;
        });
        selectAll = !selectAll;
        document.getElementById('toggleAllButton').textContent = selectAll ? 'Unselect All' : 'Select All';
    });

    // Generate random circle when the button is clicked
    document.getElementById('generateButton').addEventListener('click', function () {
        const selectedNames = Array.from(document.querySelectorAll('#checkboxContainer input[type="checkbox"]:checked'))
                                  .map(checkbox => checkbox.value);
        if (selectedNames.length > 1) {
            const circle = randomizeCircle(selectedNames);
            const outputAsCircle = document.getElementById('outputStyle').checked;
            displayCircle(circle, outputAsCircle);
            setCookie("selectedNames", JSON.stringify(selectedNames), 365); // Save selected names in cookie
        } else {
            document.getElementById('output').innerHTML = 'Please select at least 2 names.';
        }
    });

    // Randomize the circle
    function randomizeCircle(names) {
        const shuffled = [...names];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled.map((name, i) => ({
            person: name,
            follower: shuffled[(i + 1) % shuffled.length]
        }));
    }

   // Display the circle or list
function displayCircle(circle, asCircleDiagram) {
    const outputDiv = document.getElementById('output');
    const canvas = document.getElementById('circleCanvas');
    const ctx = canvas.getContext('2d');
    
    if (asCircleDiagram) {
        canvas.style.display = 'block';
        outputDiv.innerHTML = ''; // Clear previous output
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 250; // Circle radius, increased for larger names
        const circleRadius = 30; // Radius of each name circle
        
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas
        
        // Calculate angles for each name
        const angleStep = (2 * Math.PI) / circle.length;
        
        // Helper function to draw arrows that stop at the edge of the circle
        function drawArrow(fromX, fromY, toX, toY) {
            const headlen = 10; // length of arrowhead
            const angle = Math.atan2(toY - fromY, toX - fromX);
            
            // Adjust the endpoints so the line touches the circle's circumference, not center
            const adjustedFromX = fromX + circleRadius * Math.cos(angle);
            const adjustedFromY = fromY + circleRadius * Math.sin(angle);
            const adjustedToX = toX - circleRadius * Math.cos(angle);
            const adjustedToY = toY - circleRadius * Math.sin(angle);

            // Draw line
            ctx.beginPath();
            ctx.moveTo(adjustedFromX, adjustedFromY);
            ctx.lineTo(adjustedToX, adjustedToY);
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw arrowhead
            ctx.beginPath();
            ctx.moveTo(adjustedToX, adjustedToY);
            ctx.lineTo(adjustedToX - headlen * Math.cos(angle - Math.PI / 6), adjustedToY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(adjustedToX - headlen * Math.cos(angle + Math.PI / 6), adjustedToY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fillStyle = '#000000';
            ctx.fill();
        }

        circle.forEach((pair, index) => {
            const angle = index * angleStep;
            const x = centerX + radius * Math.cos(angle);
            const y = centerY + radius * Math.sin(angle);
            
            // Draw the name circle
            ctx.beginPath();
            ctx.arc(x, y, circleRadius, 0, 2 * Math.PI, false); // Increased size of circles for larger text
            ctx.fillStyle = '#4CAF50';
            ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#003300';
            ctx.stroke();
            
            // Draw the name inside the circle
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial'; // Increased font size for readability
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(pair.person, x, y);
            
            // Draw the connecting arrow to the next name
            const nextAngle = (index + 1) * angleStep;
            const nextX = centerX + radius * Math.cos(nextAngle);
            const nextY = centerY + radius * Math.sin(nextAngle);
            
            // Draw arrow from current circle to next circle
            drawArrow(x, y, nextX, nextY);
        });
    } else {
        canvas.style.display = 'none';
        outputDiv.innerHTML = '<strong>List of names with followers:</strong><br/><br/>';
        circle.forEach(pair => {
            outputDiv.innerHTML += `${pair.person} -> ${pair.follower}<br/>`;
        });
    }
}



    // Cookie functions
    function setCookie(name, value, days) {
        const d = new Date();
        d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
        const expires = "expires=" + d.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }

    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
</script>

</body>
</html>
